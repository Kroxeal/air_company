<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User List</title>
    <!-- Подключение Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">

        <!-- Добавление Content Security Policy -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; img-src 'self'">
</head>
<body>

<div class="container mt-5">
    <h1>User List</h1>
    <table class="table">
        <thead>
            <tr>
                <th>Name</th>
                <th>Surname</th>
                <th>Phone Number</th>
                <th>Email</th>
                <th>Role</th>
            </tr>
        </thead>
        <tbody id="userTableBody">
            {% for user in users %}
                <tr>
                    <td>{{ user.name }}</td>
                    <td>{{ user.surname }}</td>
                    <td>{{ user.phone_number }}</td>
                    <td>{{ user.email }}</td>
                    <td>{{ user.role }}</td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
<script>
    // Функция для загрузки данных с сервера и отображения на странице
    async function loadUsers() {
        // Получаем токен из куки
        const token = getCookie('access_token');

        // Если токен не найден, перенаправляем пользователя на страницу аутентификации
        if (!token) {
            window.location.href = '/auth/i';
            return;
        }

        // Заголовки с токеном
        const headers = {
            'Authorization': `Bearer ${token}`,
            credentials: 'include',
        };

        try {
            const response = await fetch('/user/users_all/da', { headers });

            // Проверяем успешность запроса
            if (!response.ok) {
                console.error('Ошибка при загрузке данных:', response.statusText);
                return;
            }

            const users = await response.json();

            const tableBody = document.getElementById('userTableBody');
            tableBody.innerHTML = '';

            // Проходим по каждому пользователю и добавляем строку в таблицу
            users.forEach(user => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${user.name}</td>
                    <td>${user.surname}</td>
                    <td>${user.phone_number}</td>
                    <td>${user.email}</td>
                    <td>${user.role}</td>
                `;
                tableBody.appendChild(row);
            });
        } catch (error) {
            console.error('Произошла ошибка:', error.message);
        }
    }
</script>


</body>
</html>
